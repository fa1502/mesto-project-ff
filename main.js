(()=>{"use strict";var e=function(e,t,o,n){var r=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__image"),i=r.querySelector(".card__title"),u=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),s=r.querySelector(".card__count-like");return s.textContent=e.likes.length,c.alt=e.name,c.src=e.link,i.textContent=e.name,u.addEventListener("click",(function(){return t(r,e._id)})),a.addEventListener("click",(function(){return o(a,e._id,s)})),c.addEventListener("click",(function(){return n(e.link,e.name)})),"040654428fb28bc42167382a"!==e.owner._id&&u.remove(),e.likes.find((function(e){return"040654428fb28bc42167382a"===e._id}))&&a.classList.toggle("card__like-button_is-active"),r};function t(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-39/cards/".concat(t),{method:"DELETE",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log(e)})),e.remove()}function o(e,t,o){e.classList.contains("card__like-button_is-active")?fetch("https://nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return o.textContent=e.likes.length})):fetch("https://nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return o.textContent=e.likes.length})),e.classList.toggle("card__like-button_is-active")}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("click",c),document.addEventListener("keydown",i)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",c),document.removeEventListener("keydown",i)}function c(e){var t=document.querySelector(".popup_is-opened");e.target===t&&r(t)}function i(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&r(t)}var u=document.querySelectorAll(".popup"),a=document.querySelector(".places__list"),s=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),p=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),_=document.querySelector(".popup__input_type_name"),m=document.querySelector(".popup__input_type_description"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),h=document.querySelector(".profile__image"),b=p.querySelector(".popup__close"),S=d.querySelector(".popup__close"),q=f.querySelector(".popup__close"),C=f.querySelector(".popup__image"),k=f.querySelector(".popup__caption"),L=p.querySelector(".popup__form"),E=L.querySelector(".popup__input_type_name"),g=L.querySelector(".popup__input_type_description"),x=d.querySelector(".popup__form"),j=x.querySelector(".popup__input_type_card-name"),w=x.querySelector(".popup__input_type_url"),T=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit_avatar"),P=A.querySelector(".popup__close"),z=A.querySelector(".popup__form"),B=z.querySelector(".popup__input"),D=x.querySelector(".popup__button"),N=z.querySelector(".popup__button"),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(e,t){n(f),C.src=e,C.alt=t,k.textContent=t}u.forEach((function(e){e.classList.add("popup_is-animated")})),s.addEventListener("click",(function(){return n(p),_.value=v.textContent,m.value=y.textContent,void M(L,O)})),l.addEventListener("click",(function(){return n(d)})),T.addEventListener("click",(function(){return n(A)})),b.addEventListener("click",(function(){return r(p)})),S.addEventListener("click",(function(){return r(d)})),q.addEventListener("click",(function(){return r(f)})),P.addEventListener("click",(function(){return r(A)})),L.addEventListener("submit",(function(e){var t,o;e.preventDefault(),v.textContent=E.value,y.textContent=g.value,t=E.value,o=g.value,fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me",{method:"PATCH",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),r(p)})),x.addEventListener("submit",(function(n){n.preventDefault(),H(!0);var c,i,u={};u.name=j.value,u.link=w.value,u.likes=[],u.owner={_id:"040654428fb28bc42167382a"},a.prepend(e(u,t,o,J)),(c=j.value,i=w.value,fetch("https://nomoreparties.co/v1/wff-cohort-39/cards",{method:"POST",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"},body:JSON.stringify({name:c,link:i})}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).finally((function(){return H(!1)})),x.reset(),M(x,O),r(d)})),z.addEventListener("submit",(function(e){var t;e.preventDefault(),H(!0),(t=B.value,fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me/avatar",{method:"PATCH",headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).finally((function(){return H(!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,o){console.log("isValidRun"),t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){console.log("test-");var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){console.log("test+");var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)})(e,r,t),function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}(o,n,t)}))}))}(t,e)}))}(O);var M=function(e,t){var o=e.querySelector("".concat(t.submitButtonSelector));o.disabled=!0,o.classList.add(t.inactiveButtonClass);var n=e.querySelector(".form__input-error");n.classList.remove(O.errorClass),n.textContent="",e.querySelectorAll(t.inputSelector).forEach((function(e){return e.classList.remove(O.inputErrorClass)}))};fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me ",{headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb"}}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){return e.json()})).then((function(e){v.textContent=e.name,y.textContent=e.about,h.setAttribute("style","background-image: url(".concat(e.avatar,");"))}));var V=[fetch("https://nomoreparties.co/v1/wff-cohort-39/cards ",{headers:{authorization:"1f32eed6-4700-423b-84f1-c35d36de2fbb"}}).then((function(e){return e.json()})).then((function(n){n.forEach((function(n){a.append(e(n,t,o,J))}))}))];function H(e){e?(D.textContent="Сохранение...",N.textContent="Сохранение..."):(D.textContent="Сохранить",N.textContent="Сохранить")}Promise.all(V)})();